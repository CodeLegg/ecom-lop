<!-- beds.html -->
{% extends 'base.html' %}

{% block title %}Beds{% endblock %}

{% block breadcrumbs %}
    <!-- Breadcrumbs -->
        {% if parent.name %}
            <a class="nav-title breadcrumb hdgbread" href="{% url 'category' parent.name %}">
                <i class="fa fa-chevron-left"></i>
                All {{ parent.name }}
            </a>
        {% endif %}
{% endblock %}


<!-- Content for Beds Page -->

{% block content %}

<div class="container">

    <!-- Page Title -->
    <h1> {{ category.name}} </h1>


    <!-- Category Image -->
    <div class="image-wrapper">
        <img class="category-image" src="https://via.placeholder.com/344x230/ff69b4/ffffff?text=Placeholder+Image"
            alt="Placeholder Image">
        <div class="category-image-desc">
            Quality beds for sale: Comfort, style, and affordability combined.
        </div>
    </div>
    <!-- Filter Meny -->
    <br>
    <form method="GET">
        <select name="price_filter">
            <option value="">Select price range</option>
        </select>
        <button type="submit">Filter</button>
    </form>



    <div class="item-card-grid">
        {% for product in products %}
        {% if product.is_sale %}
        <div class="item-card">
            <div class="sale-badge">
                SALE
            </div>

            {% with product.images.first as first_image %}
            {% if first_image %}
            <img src="{{ first_image.image.url }}" alt="{{ product.name }} Image">
            {% endif %}
            {% endwith %}
            <div class="card-content">
                <h3 class="card-title">{{ product.name }}</h3>
                <div class="review-stars">
                    <span class="star">&#9733;</span>
                    <span class="star">&#9733;</span>
                    <span class="star">&#9733;</span>
                    <span class="star">&#9733;</span>
                    <span class="star">&#9734;</span> <!-- Example of an empty star for a 4-star rating -->
                </div>
                <p class="card-desc">In: {{ product.category }} <br> {{ product.description|truncatechars:50 }}

                </p>
                <p class="card-desc"><strike>£{{ product.price }}</strike> &nbsp; £{{ product.sale_price }}</p>
                <a href="{% url 'product' product.id %}?next={{ request.path }}" class="view-btn">View Product</a>
                <button value="{{ product.id }}" class="cart-btn">
                    Add to cart
                </button>
            </div>
        </div>
        {% else %}
        <div class="item-card">
            {% with product.images.first as first_image %}
            {% if first_image %}
            <img src="{{ first_image.image.url }}" alt="{{ product.name }} Image">
            {% endif %}
            {% endwith %}
            <div class="card-content">
                <h3 class="card-title">{{ product.name }}</h3>
                <div class="review-stars">
                    <span class="star">&#9733;</span>
                    <span class="star">&#9733;</span>
                    <span class="star">&#9733;</span>
                    <span class="star">&#9733;</span>
                    <span class="star">&#9734;</span> <!-- Example of an empty star for a 4-star rating -->
                </div>
                <p class="card-desc">In: {{ product.category }} <br> {{ product.description|truncatechars:50 }}

                </p>
                <p class="card-desc">£{{ product.price }}</p>
                <a href="{% url 'product' product.id %}?next={{ request.path }}" class="view-btn">View Product</a>
                <button value="{{ product.id }}" class="cart-btn">
                    Add to cart
                </button>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
<script>
    
        $(document).on('click', '.cart-btn', function(e){
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: "{% url 'cart_add' %}",
                data: {
                    product_id: $(this).val(), // Use $(this) to refer to the clicked button
                    product_qty: 1, // Default quantity
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    action: 'post'
                },
                success: function(json){
                    location.reload();
                },
                error: function(xhr, errmsg, err){
                    // Handle error
                }
            });
        });
</script>
    
    


    {% endblock %}